# çº¢é»‘æ ‘

## æ€§è´¨
1. èŠ‚ç‚¹ä¸ºé»‘æˆ–è€…çº¢è‰²ã€‚
2. æ ¹ä¸€å®šæ˜¯é»‘è‰²ã€‚
3. æ‰€æœ‰å¶å­éƒ½æ˜¯é»‘è‰²ï¼ˆå¶å­æ˜¯NILèŠ‚ç‚¹ï¼‰ã€‚
4. **çº¢è‰²èŠ‚ç‚¹ä¸èƒ½è¿ç»­**ã€‚å¦‚æœè¿åï¼Œç§°ä¸ºçº¢è¿åã€‚
5. **é»‘é«˜å¹³è¡¡**ï¼šä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰ç®€å•è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚å¦‚æœè¿åï¼Œç§°ä¸ºé»‘è¿åã€‚

å½“æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹ä½¿å¾—ä¸Šé¢çš„æ€§è´¨ç ´åæ—¶ï¼Œé€šè¿‡**äº¤æ¢èŠ‚ç‚¹é¢œè‰²**æˆ–è€…**æ—‹è½¬**æ¥é‡æ–°å¹³è¡¡ã€‚

## åˆ é™¤
ç»è¿‡è½¬åŒ–ï¼Œå¯ä»¥çŸ¥é“ä¸€ä¸ªå‰ç½®æ¡ä»¶ï¼š
**ä¸‹é¢è¦åˆ é™¤çš„Mï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªéç©ºå­èŠ‚ç‚¹C**ã€‚

> https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91#%E5%88%A0%E9%99%A4

- M: è¦åˆ é™¤çš„èŠ‚ç‚¹ã€‚
- Cï¼šMçš„å„¿å­ã€‚å¯èƒ½ä¸ºéLEAFèŠ‚ç‚¹(ç‹¬ç”Ÿå­)ï¼Œä¹Ÿå¯ä»¥ä¸ºLEAFèŠ‚ç‚¹(åŒå¶å­ä¸­ä»»æ„å–ä¸€ä¸ªå¶å­ï¼Œä¸ºNULL)ã€‚

> å‚é˜…ï¼šhttp://gauss.ececs.uc.edu/Courses/c110/lectures/Week2/RedBlack/redblack.html Delete Rules

| #   | M     | C     | Possibility                                                 | Action                                                                 | Description                                                      |
|-----|-------|-------|------------------------------------------------------------------------|------------------------------------------------------------------------|------------------------------------------------------------------------|
| 1   | ğŸ”´   | âš«(NIL) + âš«(NIL) | Y           | Delete M, all thing is done.                                 | Current is a red leaf.                 |
| 2 | ğŸ”´   | âš«/ğŸ”´ +  âš«(NIL) | N                       | -                     | Current is red with one child. |
| 3 | âš« | âš« + âš«(NIL) | N           | -                                                            | Current is black with one black child. |
| 4  | âš« | ğŸ”´(ç‹¬ç”Ÿå­) +  âš«(NIL) | Y | Delete M, C replace M position, colorize C Black(balance black height) | Current is black with one red child. |
| 5  | âš« | âš«(NIL) + âš«(NIL) | Y                                               | **[need to subdivide]**                                                | Current is black and has no children.         |

> #2: This is impossible since the child must be black to avoid two reds in a row on a path but then the number of blacks on paths through the left side of the node is different from the number of blacks on paths through the right side.
>
> #3: This is impossible since the number of blacks on paths through the left side of the node is different from the number of blacks on paths through the right side.

å¯ä»¥å¾—çŸ¥ï¼Œè½¬åŒ–åï¼š

- åªéœ€è€ƒè™‘ #1 #4 #5 ä¸‰ç§æƒ…å†µã€‚#1 #4 éƒ½æ¯”è¾ƒç®€å•ã€‚

- å¯¹äºæƒ…å†µ #5 ï¼Œéœ€è¦è¿›ä¸€æ­¥è€ƒè™‘ï¼Œå› ä¸ºè¦åˆ é™¤ä¸€ä¸ªé»‘èŠ‚ç‚¹Mï¼Œå„¿å­ä¹Ÿä¸æ˜¯çº¢èŠ‚ç‚¹ï¼Œé»‘é«˜å¿…ç„¶å¤±è¡¡ã€‚
  > é»‘é«˜ä¸ºä½•ä¼šå¤±è¡¡ï¼Œå› ä¸ºåŸæ¥ç»è¿‡Mçš„è·¯å¾„ï¼Œé»‘èŠ‚ç‚¹æœ€ç»ˆä¼šå‡1ï¼›é‚£ä¹ˆä¸ç»è¿‡Mçš„è·¯å¾„ï¼Œé»‘èŠ‚ç‚¹å°±æ— ç«¯å¤šäº†1ä¸ªã€‚

  å› æ­¤ï¼Œéœ€è¦è¿›ä¸€æ­¥æ‰©å¤§ç‰µæ‰¯çš„ç»“ç‚¹åŒºåŸŸï¼Œå°†é™„è¿‘æ›´å¤šçš„èŠ‚ç‚¹è€ƒè™‘è¿›æ¥ï¼Œé‡æ–°æ„å»ºé»‘é«˜å¹³è¡¡ã€‚

ä¸¾ä¾‹ç›´è§‚è¯´æ˜ï¼š

![image-20221002154822230](assets/image-20221002154822230.png)



### åŒé»‘å™©æ¢¦

å™©æ¢¦æ˜¯ä¸ªäººå¯¹çº¢é»‘æ ‘çš„åˆ é™¤èµ‹äºˆçš„ç§°å·ï¼Œå› ä¸ºçº¢é»‘æ ‘çš„åˆ é™¤éœ€è¦è®¨è®ºçš„æƒ…å†µå¾ˆå¤šï¼Œä¸€æ—¦è¯­è¨€ç»„ç»‡è¿‡å·®ï¼Œæˆ–è€…è®²è§£æ€è·¯ä¸æ¸…æ™°ï¼Œå¾ˆå®¹æ˜“é€ æˆæ³¨æ„åŠ›åˆ†æ•£ä»¥åŠæé«˜çš„å¿ƒæ™ºè´Ÿè·ï¼Œç„¶ååŠé€€ã€‚

> The complex case is when **N** is not the root, colored black and has only NIL children (â‡” no proper child). In the first iteration, **N** is replaced by NIL.

**åœ¨è¦åˆ é™¤çš„èŠ‚ç‚¹å’Œå®ƒçš„å„¿å­äºŒè€…éƒ½æ˜¯é»‘è‰²æ—¶ï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹çš„ä¸¤ä¸ªå„¿å­éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚**

> ä¸ºä»€ä¹ˆï¼Ÿ
> - å‡è®¾1ï¼šè‹¥å…¶ä¸­ä¸€ä¸ªå„¿å­æ˜¯é»‘è‰²éå¶å­èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªå„¿å­æ˜¯å¶å­èŠ‚ç‚¹ï¼Œ é‚£ä¹ˆä»è¯¥èŠ‚ç‚¹é€šè¿‡éå¶å­èŠ‚ç‚¹å„¿å­çš„è·¯å¾„ä¸Šçš„é»‘è‰²èŠ‚ç‚¹æ•°æœ€å°ä¸º2ï¼Œ
è€Œä»è¯¥èŠ‚ç‚¹åˆ°å¦ä¸€ä¸ªå¶å­èŠ‚ç‚¹å„¿å­çš„è·¯å¾„ä¸Šçš„é»‘è‰²èŠ‚ç‚¹æ•°ä¸º1ï¼Œè¿åäº†æ€§è´¨5ã€‚**ä¸æˆç«‹**ã€‚
> - å‡è®¾2ï¼šè¯¥èŠ‚ç‚¹çš„ä¸¤ä¸ªå„¿å­ä¹Ÿä¸å¯èƒ½ä¸ºå…¨éƒ½æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œå› æ­¤ä¸€å¼€å§‹çš„è½¬åŒ–ä½¿å¾—è¯¥èŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸€ä¸ªéç©ºå­èŠ‚ç‚¹ã€‚**ä¸æˆç«‹**ã€‚
  ![](./assets/RBT-sample-1.png)
>   
> ä¸ºäº†ç›´è§‚ç†è§£ï¼Œè¿™é‡Œæœ‰ä¸€å¼ çº¢é»‘æ ‘çš„ç¤ºä¾‹å›¾ã€‚å‡è®¾ä¸€å¼€å§‹è¦åˆ é™¤çš„æ˜¯25è¿™ä¸ªèŠ‚ç‚¹ã€‚ é‚£ä¹ˆç»è¿‡è½¬åŒ–ï¼Œ25çš„å·¦å­æ ‘çš„å‰é©±èŠ‚ç‚¹çš„å€¼ 20 ä¼šèµ‹å€¼åˆ°25çš„ä½ç½®ï¼Œç„¶åé—®é¢˜è½¬åŒ–ä¸ºè¦åˆ é™¤åŸæ¥çš„20èŠ‚ç‚¹ã€‚å› æ­¤ä¸ä¼šå‡ºç°å‡è®¾2æƒ…å†µã€‚

ä¸ºäº†æè¿°çš„è§„èŒƒï¼š
- ç§°å‘¼è¿™ä¸ªå„¿å­ä¸ºNï¼ˆåœ¨æ–°çš„ä½ç½®ä¸Šï¼‰ï¼Œç§°å‘¼Nçš„çˆ¶äº²ä¸ºPã€‚
- ç§°å‘¼Nçš„å…„å¼Ÿä¸ºSã€‚ç§°å‘¼Sçš„å·¦å„¿å­ä¸ºSLï¼Œç§°å‘¼Sçš„å³å„¿å­ä¸ºSRã€‚

å¯ä»¥è¯´ï¼Œå¯ä»¥æ¶ˆé™¤åŒé»‘å¤±è¡¡é—®é¢˜ï¼ŒæŠŠå„¿å­ã€çˆ¶äº²ã€å…„å¼Ÿã€å…„å¼Ÿçš„å„¿å­éƒ½ç‰µæ‰¯äº†è¿›æ¥ã€‚

> é™„åŠ æ€è€ƒï¼šä¸ºä»€ä¹ˆç‰µæ‰¯çš„é™„è¿‘èŠ‚ç‚¹æ˜¯å„¿å­ã€çˆ¶äº²ã€å…„å¼Ÿã€å…„å¼Ÿçš„å„¿å­ï¼Ÿè€Œä¸æ˜¯å…¶ä»–ã€‚



### å…³é”®æ€è·¯

å› ä¸ºå°†æ¥currentè¦è¢«åˆ æ‰äº†ï¼ˆä¹Ÿå°±æ˜¯é»‘è‰²-1ï¼‰ï¼Œè¡¥æ•‘æ–¹æ¡ˆï¼š

- è¦ä¹ˆåœ¨é€šè¿‡currentçš„è·¯å¾„ï¼Œæ·»åŠ ä¸€ä¸ªblackèŠ‚ç‚¹æ¥ç»´æŒå¹³è¡¡ã€‚
- è¦ä¹ˆå¯¹äºä¸é€šè¿‡currentçš„è·¯å¾„ï¼Œåˆ é™¤ä¸€ä¸ªblackèŠ‚ç‚¹æ¥ç»´æŒå¹³è¡¡ã€‚

æ­¤å¤–ï¼Œæ³¨æ„ä¸èƒ½å¼•å…¥çº¢è¿åã€‚

---

æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥è¿›è¡Œåˆ†ç±»äº†ã€‚

![](./assets/delete_case_discuss.png)

é¦–å…ˆ**Nçš„è®¨è®ºå‰ææ˜¯å·²çŸ¥ä¸ºé»‘**ã€‚ä½†æ˜¯æ­¤æ—¶ä¸æ¸…æ¥šPã€Sã€SLã€SRçš„é¢œè‰²ã€‚

æˆ‘ä»¬ä»Sçš„é¢œè‰²å‡ºå‘ï¼Œä½œä¸ºåˆ†ç±»çš„çªç ´å£ï¼Œè€ƒå¯ŸPã€Sçš„é¢œè‰²ã€‚

| Sçº¢ Pé»‘ SLé»‘ SRé»‘                                            | Sé»‘ Pé»‘ SLé»‘ SR é»‘                                           | Pçº¢ Sé»‘ SLé»‘ SRé»‘                                            |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![Red-black_tree_delete_case_2](assets/Red-black_tree_delete_case_2.png) | ![Red-black_tree_delete_case_3](assets/Red-black_tree_delete_case_3.png) | ![Red-black_tree_delete_case_4](assets/Red-black_tree_delete_case_4.png) |
| case 2 => goto case 3                                        | case 3 => goto case 1 or case 4                              | case 4 => OK or case 5                                       |
| æ­¤æ—¶åˆ é™¤Nï¼Œæœªèƒ½å®Œæˆã€‚éœ€è¦è¿›ä¸€æ­¥å¤„ç†                          | éœ€è¦ä»Pç»“ç‚¹å¼€å§‹é‡æ–°é€’å½’ã€‚                                    | å®Œæˆã€‚                                                       |

| PæœªçŸ¥ï¼ŸSé»‘ SLçº¢ SRé»‘                                         | PæœªçŸ¥ï¼ŸSé»‘ SLæœªçŸ¥ï¼Ÿ SRçº¢                                     |      |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| ![Red-black_tree_delete_case_5](assets/Red-black_tree_delete_case_5.png) | ![Red-black_tree_delete_case_6](assets/Red-black_tree_delete_case_6.png) |      |
| case 5 => goto case 6                                        | case 6                                                       |      |
| case 5åªæ˜¯è½¬åŒ–ï¼Œä¸ºcase 6çš„å¤„ç†é“ºå«ã€‚                         | æ­¤æ—¶åˆ é™¤Nï¼Œæ˜¯å¹³è¡¡çš„ã€‚                                        |      |

> TODO ç»˜åˆ¶caseçŠ¶æ€æœºè½¬ç§»å›¾


## References

- [Redâ€“black tree](https://en.wikipedia.org/wiki/Red%E2%80%93black_tree)
- [Red-black tree (C)](https://web.archive.org/web/20140328232325/http://en.literateprograms.org/Red-black_tree_(C)#Insertion)
- [Red/Black Tree Visualization](https://www.cs.usfca.edu/~galles/visualization/RedBlack.html)

